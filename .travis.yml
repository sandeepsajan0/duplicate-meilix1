# This provides us with GCC binary support so we can run bash
language: generic

# Try to supply the packages from Travis so that when we run build.sh we won't
# be required to download them again.
include:
  - os: linux
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - debootstrap
          - genisoimage
          - p7zip-full
          - squashfs-tools
          - ubuntu-dev-tools
          - dpkg-dev
          - debhelper
          - fakeroot
          - devscripts

sudo: required

script:
  - chmod +x ./build.sh
  - ./build.sh

before_deploy:
  - export image_name="`echo *.iso`"
  - cat *.iso > "/home/travis/${image_name}"

after_deploy:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh; fi'

notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "TgfOxiHMKblOC108+YqjMdKjNI3YKDgUtFk5gcmWbUhWIf5RXRKO13qmkR4pw/M9eJQYCXE0ffDZEymcP8vLxp4IaK42NollknoZWGu3//HTtATQz5EWRp8GOF1bdrRyAmPIAX9HTb1YiWlsYZ8R8JhhnpSFncg32RMxRPIGH/LLurXmmST4n/jlWnWu8gn6u96AFnGDVAB2ZV+2dN7rUorMZ6mRn/NPRzDSzEX5n5K398Pg5Rtfu55+BVxKmw1qVrYtTmwC/D4ASzLlmLELwXhlRyixPbjhX38hdevB9eQ68at4hdJnwp3LrLhe4Uy5ORK8Wfzb1Nn5RnOANRgrZrCmLA/HF6+hrFo9TW7jxTjOz/hZfgsU6JtX7xzSl3CiNfSwLzGyiyrspv90tBm1mPcQqg3r/IjAEOnlS+e1/uZtA+sI38vGhawRleUOAhL1tq2vQ7QCBnpqxQAovFLTyyBmwwGw2aRZETal4+qYxEWi3u7Hm8hd33q4O0VwXEbulbN0EdAw4kwM3wB/RszyH5vHQ6fxEVrZXR61F7gGbNIVKuTMGBligNlCap0SJhDxahxWE0riEXSRanDpbEZabUDjk5Jw/sJ6Kf28ZV4F+Yliy5DW+8D25uEdrMfy542GzvaKw7td/oVulJg3Ws0tGsDQQw7kLwmtg7e8kxgx3mc=" 
    file_glob: true # http://stackoverflow.com/a/28579635/1320237
    file: "/home/travis/${image_name}"
    on:
      all_branches: true
