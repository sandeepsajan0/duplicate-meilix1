# This provides us with GCC binary support so we can run bash
language: generic

# Try to supply the packages from Travis so that when we run build.sh we won't
# be required to download them again.
include:
  - os: linux
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - debootstrap
          - genisoimage
          - p7zip-full
          - squashfs-tools
          - ubuntu-dev-tools
          - dpkg-dev
          - debhelper
          - fakeroot
          - devscripts

sudo: required

script:
  - chmod +x ./build.sh
  - ./build.sh

before_deploy:
  - export image_name="`echo *.iso`"
  - cat *.iso > "/home/travis/${image_name}"

after_deploy:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh; fi'

notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "iqIck0jh1ZVULKseN5B1WfdbIwau+A5/D+IBCQvebz91EkmnuzUbO0u8Y0HWVaS0s88vCftTqKGBIz0tIjo/wSGHRethxae07akngAZCKYCdBypYrg7Tvadox6PePvtS2n8wiF6TYKfXQvnX55+kYv1Di4aiGJc/2pizvTJUVDxzF1bZS5vg1w1v6N53Ae0XvFr1/i4EQNksFJu6Xu096O+iPhqd+Ajn6TutVppHycbQDim4p6pTHlJO8tRsQu7RvLLG6Frk2jqJuayACyKGrIdv4vr7z2FNP91KdSU/35LxLYDluKTOevp3VwLmglxK5qJBLI+a+KVGkbiHFRIaF0SQYz2cwgF3m2oKziqW/Fyv7l+oNmhrvk8R7l7kA3xXaY+Y8rLAaEAFIcZj6kFl0CiGqvrYUgrxDykWadNahn4Aj4Kye660UkZkOTm2x6QTDBO1H6qVRNb+SjnSDZ6jLi2imuUfojcABrmXJq8mfgnWscU7MVe+HWdjWWjd3BpYePLCUH8ngJgb1BG/yEj/j+O5Wjk6LVojCvk2VCXW/BfqaV/wv9wo7d++0dijDLi233bf+LPee+rxzfg4sVtz2UoYqtBvyyPATg5Hkox7DwUl3zi5O4UwpVyr6RnFbpLaeSB9GXzLw3imRDR4OsscJwSOQVdrj/4m4xipTRzWKmI="
    file_glob: true # http://stackoverflow.com/a/28579635/1320237
    file: "/home/travis/${image_name}"
    on:
      all_branches: true
