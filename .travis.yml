# This provides us with GCC binary support so we can run bash
language: generic

# Try to supply the packages from Travis so that when we run build.sh we won't
# be required to download them again.
include:
  - os: linux
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - debootstrap
          - genisoimage
          - p7zip-full
          - squashfs-tools
          - ubuntu-dev-tools
          - dpkg-dev
          - debhelper
          - fakeroot
          - devscripts

sudo: required

script:
  - chmod +x ./build.sh
  - ./build.sh

before_deploy:
  - export image_name="`echo *.iso`"
  - cat *.iso > "/home/travis/${image_name}"

after_deploy:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh; fi'

notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "g7ekuBcjhUIw1nhsd0U/CRBfvSX6vOlgFzGL18RF+h7gxB5qbDyMUb/fU8wwMxwWiYoiWjF8dPRb+y0YbmoP/lO+78c4/+Ks1AR77dz+FXYcpvBWN0MyOGG8OsHvBX5Q8KbslQ6G1VJs8gKabPPh7OHNXaONrUWFn2IOf580ydbA0TMk45uNxHuiKB9+7etxRZJypThsv7kdqqMKkqF7opXjQPBLBlQVFGHJoBvwHqVzFXp2gI8J3YdVfny5PlvpLAFmx8u1v8XshBsGcTage4ONTDf4won1maj7ATF9OSum9Z4dtKN6zLy6LFaAhK/oOVkOoyizD1Z6SidVY0jORxqaB4pNWHGmjBNkoNwbdKQRw27jLiOeCc6GyjzaGwVuPOFxW7V0X0/d/w6PCr5fO6mX/MWN2O9Oazg8TvYFnwpyKgCp+ITy2q/FCo4Yy8QmnbmSlf+eL+1XG9ayMxhFoteR+fNZ2VVmQCnTWD8OKtHIP5VhWF65Xf5ond7jKJyZdJhW0Vkm/jxLEcVqqWU2QWOEDkb0h8wBBPly424yCE4TyTc+EgI4ANmYi9JtG8P2NdnZ9cceeck9XWzkV2WkyFvVFVbY2MGA8ajuCNVqeb8PFOQ/6AkhQulguL4ngUNk+H7C1xmC0J5yUERbh2HZn8gqO1dor5TCxZ3akj5Luxg="
    file_glob: true # http://stackoverflow.com/a/28579635/1320237
    file: "/home/travis/${image_name}"
    on:
      all_branches: true
