# This provides us with GCC binary support so we can run bash
language: generic

# Try to supply the packages from Travis so that when we run build.sh we won't
# be required to download them again.
include:
  - os: linux
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - debootstrap
          - genisoimage
          - p7zip-full
          - squashfs-tools
          - ubuntu-dev-tools
          - dpkg-dev
          - debhelper
          - fakeroot
          - devscripts

sudo: required

script:
  - chmod +x ./build.sh
  - ./build.sh

before_deploy:
  - export image_name="`echo *.iso`"
  - cat *.iso > "/home/travis/${image_name}"

after_deploy:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh; fi'

notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "UHpaCoRREPwetwNbE7gO3wwRb0yt2NvMWKQ2WQ6pfqdjrSMEQQIever1tqBU8FzljmEM/nxUJwx6HTU5gYmgHiyV734s05Nq/iB/oSFnDK1MRcqkYuUvHMJTuGJG8qZSLVehTqotjgTClLTawi0RODa0IXIecp0MXa9VvNhBCT9ETj0wNIDKrdZ2KFQLaZfBrsvymd+HC7KbAzZ1tMwKSdEj4AvWD2zKGvJ4O4OA2PVk34svCtm7npDHWlR6JNnhMmaN9KNSZGXHCXDE2Sf4R19QyK23GQ7KrNQObd2OFf9OLPRZW3P3bIz0szMQWqGQ/vjKBwsol80GeuGi9GYqmdvDRG9H1BfPWJr11gR7efCktAXktJdN+bL+/e3H6a1/WV8RlIiJhdZCnvEOWCCVO/22AV9aElO7RtSSXylLA8TYHjSvTQiDkISKB6TjY2G5MsBvnFQSY5i8vHznk3rDabJ+1ywr8NH94SDbqo3l+mf869bqy6ReY+J2iUVweJro7gg9DpI9mESMId29iNsHlk8KjXjM1gT/Brz6PhYtjnwyflou5MaXuvUokhWQ4TN0LQg4Zr4xId8qC+ZduxO1qDp8fB/nB4pRIF32TfmdQOOsmZLKPL8IN4WNSsc2YM0GfTCPYXQQ5yhT1QLxRpey96zUfG/9Oi/vTE25QgtG4Oc="
    file_glob: true # http://stackoverflow.com/a/28579635/1320237
    file: "/home/travis/${image_name}"
    on:
      all_branches: true
