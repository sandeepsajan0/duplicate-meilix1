# This provides us with GCC binary support so we can run bash
language: generic

# Try to supply the packages from Travis so that when we run build.sh we won't
# be required to download them again.
include:
  - os: linux
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - debootstrap
          - genisoimage
          - p7zip-full
          - squashfs-tools
          - ubuntu-dev-tools
          - dpkg-dev
          - debhelper
          - fakeroot
          - devscripts

sudo: required

script:
  - chmod +x ./build.sh
  - ./build.sh

before_deploy:
  - export image_name="`echo *.iso`"
  - cat *.iso > "/home/travis/${image_name}"

after_deploy:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh; fi'

notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "S8SSlysAG7WTrDwZpwkEB2UacYV5bPlhHBdPMgtTxqQA64mWRta7HyKdBkew0nXGi3GvxPkFTJu+69OCz/4A7eFQGDnikT1ARYZtNQ5d11JCGtfsqoRZRQ1FSsbvGM+HVuqLBMhkdPhnVX7mSmtIUF3Y7Qd7oU/hczQr92vFYS8uO7T5hcTaAlSS2ipvpqqH0HhQ28K1TzrMkML1TL6VDAzHvNccfGkbDxFjUvwdyiOT1mIe7QbQcHeLfl5anC3zcHEm/VVozfkrA3nC8u3TU5aNfz10A+uOgrBdffmJWrO3YIEYvNvNJj6PZnS5fgaiNT/KWiQBC0j0OANsW2p+jr3TvBhz9IsGcojQMXWc/Fi0vdd3Y59ZGU4RL68HZqo+yD5tvM+PN69MK+VM/udVApySXjCY8SwKyYXe9hGNItxQ7PnBEAbdx7yERx0T0Btty2b9x7VPH9/wPVEFzbGjjfUULELl+e9oJgS/6Lln29P3/MzsAlgg5WJKDUoUdYzDdm8R5he0OQAFoX1lnx1b6yPej8locgtc8k6ynVOTXhJAwf0cswJRDp8pBfo6Rnw5AKz7Ls1wGfOvwvNR65mP4T5XJ2f0Q9N1qEvNlsLxbHooGnSfYE8IewkDMDN5CGYAzNkcb3yPCoJ2jmUubpGp2Y2/94F0xg+u0mYpVhGHENI="
    file_glob: true # http://stackoverflow.com/a/28579635/1320237
    file: "/home/travis/${image_name}"
    on:
      all_branches: true
