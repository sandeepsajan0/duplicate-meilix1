# This provides us with GCC binary support so we can run bash
language: generic

# Try to supply the packages from Travis so that when we run build.sh we won't
# be required to download them again.
include:
  - os: linux
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - debootstrap
          - genisoimage
          - p7zip-full
          - squashfs-tools
          - ubuntu-dev-tools
          - dpkg-dev
          - debhelper
          - fakeroot
          - devscripts

sudo: required

script:
  - chmod +x ./build.sh
  - ./build.sh

before_deploy:
  - export image_name="`echo *.iso`"
  - cat *.iso > "/home/travis/${image_name}"

after_deploy:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh; fi'

notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "IC4BM1Pu2x7n9zROqKEme+1C6hu9Thnf8qGffS+Hme8eUb+qXtunGlGHN32k5WFCTqWQlGH+bZzma2EH3hLkJK2bRav5/V1Ydhmgx0hwaLyP+Om7RJmQ3StTNh0ZDyU9mId0xQ5tIh1xZeD4tbabRez5XuRt2S9jNrnYhoOo0gbyH8styxwcM+GbZVA9VaZ0u6gANqqasWltMkc+pqYusiepp457g4pBscPhNiXbmdW65Tmqxkk8ycAmHbsJ1IcyvoXm2uBCQ3Op5O4+zURGgt+w5XPAagZV8MBJODZO+AK1Waf+V511QvVfHcDoM3acXjUzN8qGZuqS5I7Ii9sS3oOAtx0PsDDLM9AU9mcEp9ziAZyqDZHbRKyRyxdxS89ZmL3teFcy/HWz/dR9VvuIAe5u+f7573e76BIxrSt9AtLdL/wsdBv+Fci/CiX6CfQ3fO1dZIg4lh07+m0ZWds08kWrKPSI2C0nrDjP7Gs6w+Rt3phy7aindoqjfXmJLNfNXzxCWK6eH5hriTep7v/wGX1E6pFXfPxihF+vimTyudXK1QU0rEN9TtVbL+MyCmPrHwQx1kNrK40vmaydQsFXcHtlLQ/e4w+Jc/ZOGbMZfndeKJBKlZii34n1askD1mQX0iTHTE1zhNEgUC5rsH5A3hlvRVwCM8rIreHMAvz0rJA="
    file_glob: true # http://stackoverflow.com/a/28579635/1320237
    file: "/home/travis/${image_name}"
    on:
      all_branches: true
